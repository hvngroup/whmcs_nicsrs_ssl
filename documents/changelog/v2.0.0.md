# Changelog - NicSRS SSL Server Provisioning Module

All notable changes to the NicSRS SSL Server Provisioning Module will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

## [2.0.0] - 2025-01-24

### Added

#### API Token Centralization
- Unified API token management via Addon Module (`nicsrs_ssl_admin`)
- Automatic token retrieval from `tbladdonmodules` table
- Fallback to product-level token for backward compatibility

#### Enhanced Client Area
- **Manage Certificate** button with full certificate details
- **Reissue Certificate** button for certificate renewal
- **Download Certificate** dropdown with multiple formats
- Modern progress tracker for DCV validation steps
- Interactive domain validation interface
- Copy-to-clipboard for validation instructions

#### New Template Files
- `pending.tpl` - Pending validation view with progress tracker
- `reissue.tpl` - Certificate reissue request form
- `nicsrs-modern.css` - Ant Design-inspired styling
- `nicsrs-client.js` - Client-side JavaScript utilities

#### Enhanced Admin Area
- **Refresh Status** - Sync certificate status from NicSRS API
- **Cancel Certificate** - Cancel pending orders
- **Revoke Certificate** - Revoke issued certificates
- **View in Admin** - Direct link to Addon Module order detail
- Admin Services Tab with certificate information display

#### WHMCS Hooks Integration
- `hooks.php` - New file for WHMCS event hooks
- ClientAreaPrimarySidebar customization
- Service details enhancement

#### Modern UI/UX
- Ant Design-inspired interface
- Responsive design for mobile devices
- Status badges with color-coded indicators
- Toast notifications for user feedback
- Progress tracker with CSS animations

### Changed

#### Core Files Updated
| File | Changes |
|------|---------|
| `nicsrs_ssl.php` | Version 2.0.0, new admin buttons, enhanced config |
| `nicsrsAPI.php` | `getAddonApiToken()` method, shared token support |
| `nicsrsSSLSql.php` | Enhanced query methods |
| `nicsrsFunc.php` | New utility functions |
| `nicsrsResponse.php` | Improved response formatting |
| `nicsrsTemplate.php` | Template helper updates |
| `PageController.php` | New page handlers |
| `ActionController.php` | New AJAX actions |
| `PageDispatcher.php` | Route updates |
| `ActionDispatcher.php` | Action routing updates |
| `const.php` | New constants |

#### Template Updates
| Template | Changes |
|----------|---------|
| `applycert.tpl` | Modern form styling, improved validation |
| `complete.tpl` | Download options, certificate details |
| `message.tpl` | Enhanced status display |
| `error.tpl` | Better error presentation |

#### Language Files
- `english.php` - New translation keys for v2.0 features
- `vietnamese.php` - Complete Vietnamese translation

### Technical

#### New JavaScript Class
```javascript
class NicsrsSSL {
  - updateDcvMethod(domain, method)
  - refreshStatus()
  - downloadCertificate(format)
  - copyToClipboard(text)
  - showNotification(type, message)
}
```

#### New CSS Features
- CSS custom properties for theming
- Flexbox/Grid layouts
- Smooth animations and transitions
- Mobile-first responsive design

### Backward Compatibility
- No database schema changes required
- Existing orders continue to work
- Legacy API token configuration still supported
- Original directory structure preserved

---

## [1.1.0] - 2024-06-XX

### Added
- sslTrus certificate support (DV/OV/EV variants)
- IP address SSL for select certificates
- Vietnamese language file
- Enhanced multi-domain handling
- DCV batch update functionality

### Fixed
- Multi-domain wildcard domain count display
- Chinese Traditional encoding issues
- Certificate download file permissions

### Security
- Input sanitization for form submissions
- Session validation improvements
- API token handling enhancements

---

## [1.0.0] - 2023-XX-XX

### Added

#### Initial Release
- WHMCS provisioning module integration
- Certificate Authority support:
  - Sectigo (Comodo)
  - DigiCert
  - GlobalSign
  - GeoTrust
  - Symantec
  - Entrust
  - BaiduTrust

#### Certificate Types
- Domain Validation (DV)
- Organization Validation (OV)
- Extended Validation (EV)
- Wildcard SSL
- Multi-Domain (SAN/UCC)
- Code Signing
- S/MIME Email

#### DCV Methods
- Email validation
- HTTP file validation
- HTTPS file validation
- DNS CNAME validation

#### Languages
- English
- Chinese (Simplified)
- Chinese (Traditional)

#### Features
- Certificate application
- Certificate reissuance
- Certificate revocation
- Status tracking
- Multiple download formats (Apache, Nginx, IIS, Tomcat)

---

## File Structure

```
modules/servers/nicsrs_ssl/
├── nicsrs_ssl.php              # Main module [v2.0]
├── hooks.php                   # WHMCS hooks [NEW]
├── lang/
│   ├── english.php             # [UPDATED]
│   ├── vietnamese.php          # [UPDATED]
│   ├── chinese.php
│   └── chinese-cn.php
├── src/
│   ├── config/
│   │   ├── const.php           # [UPDATED]
│   │   └── country.json
│   └── model/
│       ├── Controller/
│       │   ├── PageController.php    # [UPDATED]
│       │   └── ActionController.php  # [UPDATED]
│       ├── Dispatcher/
│       │   ├── PageDispatcher.php    # [UPDATED]
│       │   └── ActionDispatcher.php  # [UPDATED]
│       └── Service/
│           ├── nicsrsAPI.php         # [UPDATED]
│           ├── nicsrsFunc.php        # [UPDATED]
│           ├── nicsrsResponse.php    # [UPDATED]
│           ├── nicsrsSSLSql.php      # [UPDATED]
│           └── nicsrsTemplate.php    # [UPDATED]
└── view/
    ├── applycert.tpl           # [UPDATED]
    ├── complete.tpl            # [UPDATED]
    ├── pending.tpl             # [NEW]
    ├── reissue.tpl             # [NEW]
    ├── message.tpl             # [UPDATED]
    ├── error.tpl               # [UPDATED]
    ├── replace.tpl
    ├── replace1.tpl
    └── home/
        ├── css/
        │   ├── style.css
        │   └── nicsrs-modern.css   # [NEW]
        └── js/
            ├── jquery.min.js
            └── nicsrs-client.js    # [NEW]
```

---

## Upgrade Guide

### From 1.x to 2.0.0

1. **Backup** current module folder
2. **Install Addon Module** (`nicsrs_ssl_admin`) if not already installed
3. **Configure API token** in Addon Module Settings
4. **Upload** new Server Module files (overwrite)
5. **Clear** WHMCS template cache: `rm -rf /templates_c/*`
6. **Test** with existing and new orders

### Requirements
- PHP 7.2+
- WHMCS 7.0+
- NicSRS SSL Admin Addon Module (recommended)

---

## Support

- **Website**: https://hvn.vn
- **Email**: support@hvn.vn
- **Docs**: https://hvn.vn/docs/nicsrs-ssl

---

**© 2025 HVN GROUP. All rights reserved.**